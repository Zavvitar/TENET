"use strict";var global_filters;function writeCookie(e){var t={id:e,version:$("#"+e+" #state_version").html(),isCompleted:$("#"+e+" #state_isCompleted").html(),isCollapsed:$("#"+e+" #state_isCollapsed").html(),isFavorite:$("#"+e+" #state_isFavorite").html(),expires:$("#"+e+" #state_expires").html()},n="; expires="+moment(t.expires).toDate().toUTCString();document.cookie=e+"="+encodeURI(JSON.stringify(t))+n+"; path=/"}function readCookie(e){for(var t,n=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(t=a[o];" "==t.charAt(0);)t=t.substring(1,t.length);if(0==t.indexOf(n))return decodeURIComponent(t.substring(n.length,t.length))}return""}function createFilters(){var e=readCookie("filters");if(e)return global_filters=JSON.parse(e),setFilterCheckboxes(),void filterEvents();for(var t=$(".filter-group-content"),n=[],a=0;a<t.length;a++){var o={};o.id=$(t[a]).attr("id"),o.items=[];for(var r=$("#"+o.id+" .custom-control-input"),i=0;i<r.length;i++){var s={};s.id=$(r[i]).attr("id"),s.active=!1,o.items.push(s)}n.push(o)}global_filters=n}function getEventsForDate(e,t){return $("#"+e).fullCalendar("clientEvents",function(e){return 1==e.allDay?e.start.format("YYYY/MM/DD")==moment().format("YYYY/MM/DD"):t<=e.end&&t>=e.start})}function addCollapseToEventCards(){for(var e=$(".eventCardContainer"),t=0;t<e.length;t++){var n=$(e[t]).attr("id");"true"==$("#"+n+" #meta_isCollapsable").html()&&($("#"+n+" #eventCardHeader").attr("data-toggle","collapse"),$("#"+n+" #eventCardHeader").attr("data-target","#"+n+"_content"),$("#"+n+" #eventCardHeader").addClass("isCollapsable"))}}function parseEvents(e,t){for(var n=0;n<e.length;n++){var a=e[n],o=e[n].location,r=moment(e[n].start,"ddd MMM D YYYY hh:mm:ss Z"),i=moment(e[n].end,"ddd MMM D YYYY hh:mm:ss Z");moment.duration(i.diff(r)),$("#"+o+" #meta_repeats").html();$("#"+o+" #meta_startDate").text(r.format()),$("#"+o+" #meta_endDate").text(i.format()),$("#"+o+" #meta_gcal_id").text(a.id),a.description&&$("#"+o+" #eventCardDescription").html(a.description),$("#"+o+" #calendarIcon").attr("href",a.url),$("#"+o+" #calendarIcon").removeClass("footerCalendarDisabled"),$("#"+o+" #calendarIcon").addClass("footerCalendarEnabled"),$("#"+o).removeClass("hiddenEventCard")}updateDurationTimers()}function filterEvents(){for(var e=$(".eventCardContainer").not(".hiddenEventCard"),t=getActiveFilters(),n=0;n<e.length;n++){var a=e[n],o=0<t.length;for(var r in t){var i=t[r],s="#meta_"+i.id.replace("_filter","");if($(a).find(s).length){var d=$(a).find(s).text().split(","),l=i.items.filter(function(e,t,n){return e.active});for(var c in l)console.log(l),d.includes(l[c].id)&&(o=!1)}}1==o?$(e[n]).addClass("filtered"):$(e[n]).removeClass("filtered")}}function applyFilters(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];for(var t in global_filters){var n=global_filters[t].items;for(var a in n){var o=n[a];1==e?(o.active=!1,$("#"+o.id).prop("checked",!1)):o.active=$("#"+o.id).prop("checked")}}filterEvents(),document.cookie="filters="+JSON.stringify(global_filters)}function setFilterCheckboxes(){for(var e in global_filters){var t=global_filters[e].items;for(var n in t){var a=t[n];$("#"+a.id).prop("checked",a.active)}}}function getActiveFilters(){return global_filters.filter(function(e,t,n){return 0<e.items.filter(function(e,t,n){return e.active}).length})}function sortEvents(){var e=$("div.eventCardContainer").not(".hiddenEventCard").sort(function(e,t){var n=$(e).find("#eventCardCheckBox").hasClass("fa-check-square"),a=$(t).find("#eventCardCheckBox").hasClass("fa-check-square");if(n&&!a)return 1;if(!n&&a)return-1;if(!n&&!a){var o="true"==$(e).find("#meta_unlocked_event").html(),r="true"==$(t).find("#meta_unlocked_event").html();if(o&&!r)return-1;if(!o&&r)return-1}var i=moment($(e).find("#meta_endDate").html()).format("x"),s=moment($(t).find("#meta_endDate").html()).format("x");return i<s?-1:s<i?1:0});$("div.siteContainer").html(e)}function updateDurationTimers(){$("div.eventCardContainer").each(function(){updateDurationTimer($(this).attr("id"))})}function updateDurationTimer(e){var t,n,a;1!=$("#"+e).find("#eventCardCheckBox").hasClass("fa-check-square")&&("Event not active"!=(a=createCountdownString(t=moment($("#"+e).find("#meta_startDate").html()),n=moment($("#"+e).find("#meta_endDate").html()),$("#"+e).find("#meta_repeats").html(),$("#"+e).find("#meta_unlocked_event").html()))&&(t.isAfter()?moment.duration(t.diff(moment())):moment.duration(n.diff(moment()))).asHours()<=24&&(a.includes("Ends")||a.includes("Resets")?$("#"+e).find("#eventCardFooter").addClass("countdownFooterEndingSoon"):$("#"+e).find("#eventCardFooter").addClass("countdownFooterStartingSoon"),$("#"+e).find("#countdown").addClass("countdownBold")),$("#"+e).find("#countdown").html(a))}function fixHeight(){var e;window.innerWidth<737?$("div.eventCardContentContainer").each(function(){$(this).css("height","auto")}):(e=[],$("div.eventCardContentContainer").each(function(){e.push($(this).height())}),e.sort(function(e,t){return t<e?-1:e<t?1:0}),$("div.eventCardContentContainer").each(function(){$(this).height(e[0])}))}function createCountdownString(e,t,n,a){var o,r="Event not active";if("true"==a)return"Begins Today!";if(e.isAfter())r="Starts in ",starting=!0,o=moment.duration(e.diff(moment()));else{if(!t.isAfter())return r;r="true"==n?"Resets in ":"Ends in ",o=moment.duration(t.diff(moment()))}return 24<=o.asHours()?r+=o.humanize():(o.get("hours")<10&&(r+="0"),r+=o.get("hours")+":",o.get("minutes")<10&&(r+="0"),r+=o.get("minutes")+":",o.get("seconds")<10&&(r+="0"),r+=o.get("seconds")),r}function toggleEventCardCompleted(e){$("#"+e).hasClass("completedEventCard")?($("#"+e).removeClass("completedEventCard"),$("#"+e+" #eventCardCheckBox").removeClass("fa-check-square"),$("#"+e+" #eventCardCheckBox").addClass("fa-square"),$("#"+e+" #eventCardFooter").removeClass("countdownFooterStartingSoon"),$("#"+e+" #state_isCompleted").text("false"),updateDurationTimer(e)):($("#"+e).addClass("completedEventCard"),$("#"+e+" #eventCardCheckBox").removeClass("fa-square"),$("#"+e+" #eventCardCheckBox").addClass("fa-check-square"),$("#"+e+" #eventCardFooter").addClass("countdownFooterStartingSoon"),$("#"+e+" #countdown").html("Completed!"),$("#"+e+" #state_isCompleted").text("true")),$("#"+e+"_content").hasClass("show")&&($("#"+e+"_content").removeClass("show"),toggleCollapseArrow(e)),writeCookie(e),sortEvents()}function nextReset(){var e=moment(),t=e.clone().startOf("hour").hour("17");return e<t?t:t.add(1,"day")}function enableTooltips(){$(".inventoryItemContainer").each(function(){var e=$(this),t=$(this).attr("id"),a=$("#"+t+"_tooltip");e.on("mousemove",function(e){var t,n;t=e.pageX<window.innerWidth/2?e.offsetX+14:e.offsetX-a.width()-8,n=e.clientY<window.innerHeight/2?e.offsetY:e.offsetY-a.height(),a.attr("style","left: "+t+"px; top: "+n+"px;")})})}function toggleCollapseArrow(e){var t;"true"==$("#"+e+" #meta_isCollapsable").html()&&(t="#"+e+" #eventCardArrow",$(t).hasClass("fa-chevron-right")?($(t).removeClass("fa-chevron-right"),$(t).addClass("fa-chevron-down")):$(t).hasClass("fa-chevron-down")&&($(t).removeClass("fa-chevron-down"),$(t).addClass("fa-chevron-right")))}function beforeBountyTagAdded(e,o){console.log(o.tagLabel),$(".bountyContainer").each(function(e){var a=$(this);a.find("#metadata > li").each(function(e){var t,n=$(this);console.log(o.tagLabel),console.log(n.text()),o.tagLabel==n.text()&&(t=parseInt(a.attr("tagcount"),10)+1,a.attr("tagcount",t),a.removeClass("bountyFilterHidden"),a.addClass("bountyFilterVisible"))})}),calculateBountyXP()}function beforeBountyTagRemoved(e,o){$(".bountyContainer").each(function(e){var a=$(this);a.find("#metadata > li").each(function(e){var t,n=$(this);o.tagLabel==n.text()&&((t=parseInt(a.attr("tagcount"),10)-1)<=0&&(t=0,a.addClass("bountyFilterHidden"),a.removeClass("bountyFilterVisible")),a.attr("tagcount",t))})}),calculateBountyXP()}function calculateBountyXP(){var a=0;$(".bountyContainer").each(function(e){var t,n=$(this);0<parseInt(n.attr("tagcount"),10)&&(0<(t=parseInt(n.attr("xp"),10))&&(a+=t))}),$("#XPBase").text(a.toLocaleString()),$("#XP10").text((1.1*a).toLocaleString()),$("#XP30").text((1.3*a).toLocaleString()),$("#XP42").text((1.42*a).toLocaleString())}$(function(){createFilters();var t=(t=window.location.pathname).replace(/\/$/,"");t=decodeURIComponent(t),$(".nav-link").each(function(){var e=$(this).attr("href");0==t.length&&"/"==e&&($(this).closest("li").addClass("active"),$("#locationFilterDropdownButton").removeClass("hidden"),$("#tower").removeClass("hidden")),t===e&&("/public_events"===e?($("#locationFilterDropdownButton").removeClass("hidden"),fixHeight(),$(window).resize(fixHeight)):"/wishing_wall"===e||"/catalysts"===e?($("#locationFilterDropdownButton").addClass("hidden"),fixHeight(),$(window).resize(fixHeight)):$("#locationFilterDropdownButton").addClass("hidden"),$("#tower").addClass("hidden"),$(this).closest("li").addClass("active"))});var e=new URLSearchParams(window.location.search);function n(){dataLayer.push(arguments)}e.get("location")&&setLocationFilter(e.get("location")),window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","UA-129057719-1");var a=moment();$("#fullCalendar").fullCalendar({timezone:"local",defaultDate:a,defaultView:"oneDay",views:{oneDay:{type:"agenda",duration:{days:1}}},googleCalendarApiKey:"AIzaSyDx8ACqzFjxkepAXMLsXQT4k5NOMrkH4c0",events:{googleCalendarId:"nj3fjnnn7dof8p3a0l47pf9hgs@group.calendar.google.com",className:"gcal-event"},eventAfterAllRender:function(){parseEvents(getEventsForDate("fullCalendar",a),a),sortEvents(),setInterval(function(){updateDurationTimers()},1e3),$(document).trigger("afterEventsParsed")}}),addCollapseToEventCards(),$(".dropdown-toggle").dropdown(),enableTooltips()}),$(document).on("afterEventsParsed",function(){enableTooltips()});